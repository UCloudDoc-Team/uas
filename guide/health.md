# 健康检查

您可以通过，弹性伸缩 ( UAS ) 控制台，伸缩组的详情，规则信息部分，查看健康检查是否开启。

![规则信息](/images/rule.png)

通过点击更改规则修改健康检查设置。

![更改规则](/images/rule_2.png)

## 主机健康检查

### 健康检查规则

* 检查主机是否处于运行状态（Running）。如果主机因为硬件、网络或虚拟化平台异常进入错误状态，则会被判定为不健康。

### 宽限期

* **默认值**：10 分钟（600 秒）
* **作用**：当新实例启动后，在宽限期内暂不执行健康检查。此时实例可进行系统引导、应用初始化、服务注册等操作。
* **说明**：只有在宽限期结束后，伸缩组才会根据健康检查结果判定实例是否健康。若宽限期内实例启动失败或被用户标记为不健康，则会立即触发替换。

### 规则细节

| 时间阶段           | 触发条件             | 执行动作              | 备注            |
|----------------|------------------|-------------------|---------------|
| 云主机创建后 0-10 分钟 | 新创建的云主机          | 进入健康检查宽限期，不标记为不健康 | 给实例留出启动与初始化时间 |
| 云主机创建后 10 分钟起  | 系统状态检查失败（如暂停、关机） | 标记云主机不健康，从伸缩组中移出  | 避免不健康主机继续占用容量 |

## 负载均衡健康检查

负载均衡健康检查独立于主机健康检查，基于负载均衡器 VServer 的判断。
负载均衡会持续主动探测主机是否健康，可以参照[健康检查](https://docs.ucloud.cn/ulb/faq/ulbhealthcheck)。

弹性伸缩，会持续检查负载均衡的服务云主机是否满足健康条件，并在服务云主机不健康时删除云主机，然后迅速重新创建一台。

### 规则细节

| 时间阶段          | 触发条件        | 执行动作                | 备注             |
|---------------|-------------|---------------------|----------------|
| 云主机创建后 0-5 分钟 | 新创建的云主机     | 等待主机启动完毕，不标记为不健康    | 不影响负载均衡与云主机的连接 |
| 云主机创建后 5 分钟起  | 负载均衡侧检查失败   | 标记云主机不健康，负载均衡停止发送流量 | 避免将流量发送到故障主机   |
| 标记不健康后 5 分钟内  | 负载均衡侧持续检查失败 | 删除云主机并自动创建新主机       | 确保服务可用性        |
| 标记不健康后 5 分钟内  | 负载均衡侧检查恢复正常 | 恢复为健康状态，继续提供服务      | 避免误删临时故障的主机    |

Tips: 标记不健康以及删除云主机时负载均衡会记录事件在操作日志中。