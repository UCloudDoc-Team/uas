# CPU 目标检查（ CPU 目标跟踪伸缩 ）

您可以通过，弹性伸缩 ( UAS ) 控制台，伸缩组的详情，规则信息部分，
查看 CPU 目标检查是否开启。

![规则信息](/images/rule.png)

通过点击更改规则修改相关设置。 包括开启与关闭，以及目标值。

![更改规则](/images/rule_2.png)

## CPU 目标跟踪伸缩策略

CPU 目标跟踪伸缩策略根据伸缩组内云主机的 CPU 使用率，自动调整实例数量，维持设定的目标 CPU 使用率。

#### 基本计算公式

系统定期采集伸缩组内所有云主机的 CPU 指标，并通过以下公式计算期望的实例数，通过跟踪 CPU 目标值来伸缩来扩缩容：

```
期望实例数 = ⌈所有实例 CPU 使用率之和 / 目标 CPU 使用率⌉
```

**计算示例：**
- 当前 3 台云主机，各自 CPU 使用率：60%、70%、80%
- 目标 CPU 使用率：50%
- 计算：⌈(60 + 70 + 80) / 50⌉ = ⌈210 / 50⌉ = 5
- 系统将扩容至 5 台云主机

### 规则配置

#### 基础相关配置

| 配置项    | 说明            | 默认值     | 取值范围     |
|--------|---------------|---------|----------|
| 主机最小数量 | 伸缩组最少保持的实例数量  | 必填      | >= 0     |
| 主机最大数量 | 伸缩组最多可扩展的实例数量 | 必填      | >= 最小实例数 |
| 冷却周期   | 默认的伸缩冷却时间（秒）  | 300     | > 0      |
| 目标值    | 根据            | ["cpu"] | -        |

### 伸缩行为

#### CPU 目标跟踪伸缩场景

**扩容触发条件：**
- 当前实例数在最小/最大范围内
- 所有健康实例的 CPU 总和超过 (当前实例数 × 扩容目标值) 5%
- 不在冷却期内

**缩容触发条件：**
- 当前实例数在最小/最大范围内
- 所有健康实例的 CPU 总和低于 (期望实例数 × 缩容目标值) 5%
- 不在冷却期内

#### 边界调整场景

当实例数超出配置的最小/最大限制时，系统会立即调整，不受 CPU 使用率影响：

- **低于最小值**：立即扩容至最小实例数
- **高于最大值**：立即缩容至最大实例数

这种调整会标记为 "主机数量区间" 类型的伸缩事件。

### 特殊机制

#### 1. 冷却时间机制
- 每次伸缩后进入冷却期，期间不执行新的伸缩操作

#### 2. 指标过滤机制
- 仅统计状态为运行中的云主机指标
- 排除正在启动、停止或故障的主机
- 确保伸缩决策基于健康实例的真实负载

#### 3. 伸缩事件记录
系统会记录每次伸缩活动：
- **扩容事件**：记录触发类型（CPU/主机数量区间）、增加数量、新旧实例数
- **缩容事件**：记录触发类型、减少数量、新旧实例数

### 注意事项

- 基于 CPU 的缩容规则不会导致主机数降低到0。
- 当主机最小数量为0时，创建出的伸缩组的初始主机数量会为 0 。
